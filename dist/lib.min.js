/*!
 * {LIB} v0.1.0
 * (c) 2018 {NAME}
 * Released under the MIT License.
 */
!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("quill-spellchecker"),require("underscore"),require("quill-string-normalizer"),require("diff")):"function"==typeof define&&define.amd?define(["exports","quill-spellchecker","underscore","quill-string-normalizer","diff"],r):r(e.lib=e.lib||{},e.quillSpellchecker,e._,e.quillStringNormalizer,e.diff)}(this,function(e,r,n,t,o){"use strict";function i(e){return n.where(e,{optimal:!0})}function u(e){return n.sortBy(i(e),function(e){return e.count}).reverse()[0]}function a(e,r){return n.find(r,function(r){return t.stringNormalize(r.text)===t.stringNormalize(e)})}function c(e,r){return void 0===r&&(r=!1),{conceptUID:e,correct:r}}function s(e,r){return n.find(r,function(r){var t=r.text.split("|||");return!n.any(t,function(r){return-1!==e.indexOf(r)})})}function f(e,r,n){var t=s(e,r);if(t)return d(t,n)}function d(e,r){var n={feedback:e.feedback,author:"Focus Point Hint",parent_id:u(r).id};return e.concept_uid&&(n.concept_results=[c(e.concept_uid)]),e.concept_results&&(n.concept_results=e.concept_results),n}function p(e,r){return n.find(r,function(r){var t=r.text.split("|||");return n.any(t,function(r){return new RegExp(r).test(e)})})}function l(e,r,n){var t=p(e,r);if(t)return h(t,n)}function h(e,r){var n={feedback:e.feedback,author:"Incorrect Sequence Hint",parent_id:u(r).id};return e.concept_results&&(n.concept_results=e.concept_results),n}function v(e,r){return n.find(i(r),function(r){return t.stringNormalize(r.text).toLowerCase()===t.stringNormalize(e).toLowerCase()})}function m(e,r){var n=v(e,r);if(n){return g(r,n.id)}}function g(e,r){return{feedback:xe.caseError,author:"Capitalization Hint",parent_id:r,concept_results:[c("66upe3S5uvqxuHoHOt4PcQ")]}}function b(e){return e.replace(/[^A-Za-z0-9\s]/g,"")}function k(e,r){return n.find(i(r),function(r){return b(t.stringNormalize(r.text))===b(t.stringNormalize(e))})}function w(e,r){var n=k(e,r);if(n){return y(r,n.id)}}function y(e,r){return{feedback:xe.punctuationError,author:"Punctuation Hint",parent_id:r,concept_results:[c("mdFUuuNR7N352bbMw4Mj9Q")]}}function _(e,r){return n.find(i(r),function(r){return N(t.stringNormalize(e)).toLowerCase()===N(t.stringNormalize(r.text)).toLowerCase()})}function N(e){return e.replace(/[^A-Za-z0-9\s]/g,"")}function R(e,r){var n=_(e,r);if(n){return x(r,n.id)}}function x(e,r){return{feedback:xe.punctuationAndCaseError,author:"Punctuation and Case Hint",parent_id:r,concept_results:[c("66upe3S5uvqxuHoHOt4PcQ"),c("mdFUuuNR7N352bbMw4Mj9Q")]}}function W(e){return"<p>Revise your sentence. You don't need to have a space before a <em>"+Oe[e]+"</em>.</p>"}function O(e){return n.find(We,function(r){return-1!==e.indexOf(r)})}function A(e){var r=O(e);return r?{feedback:W(r)}:void 0}function E(e){return A(e)}function P(e,r){var n=E(e);if(n){return C(r,n.feedback)}}function C(e,r){return{feedback:r,author:"Punctuation Hint",parent_id:u(e)?u(e).id:void 0,concept_results:[c("mdFUuuNR7N352bbMw4Mj9Q")]}}function H(e){for(var r=0;r<e.length;r++)if(","===e[r]&&r+1<e.length&&" "!==e[r+1])return!0;return!1}function q(e,r){if(H(e))return z(r)}function z(e){return{feedback:xe.spacingAfterCommaError,author:"Punctuation Hint",parent_id:u(e)?u(e).id:void 0,concept_results:[c("mdFUuuNR7N352bbMw4Mj9Q")]}}function D(e,r){return n.find(i(r),function(r){return Ae(t.stringNormalize(e))===Ae(t.stringNormalize(r.text))})}function I(e,r){var n=D(e,r);if(n){return T(r,n.id)}}function T(e,r){return{feedback:xe.whitespaceError,author:"Whitespace Hint",parent_id:r,concept_results:[c("5Yv4-kNHwwCO2p8HI90oqQ")]}}function S(e){if(e){var r=Pe[j(e)];if(r)return r.feedback}}function j(e){return e.trim().toLowerCase()}function L(e,r){var n=Q(e,r);if(n)return B(n)}function M(e,r){var n=Y(e,r);if(n)return V(n)}function B(e){var r={};switch(e.errorType){case Ce.INCORRECT_WORD:var n=e.missingText,t=S(n);return r.feedback=t||xe.modifiedWordError,r.author="Modified Word Hint",r.parent_id=e.response.key,r.concept_results=[c("H-2lrblngQAQ8_s-ctye4g")],r;case Ce.ADDITIONAL_WORD:return r.feedback=xe.additionalWordError,r.author="Additional Word Hint",r.parent_id=e.response.key,r.concept_results=[c("QYHg1tpDghy5AHWpsIodAg")],r;case Ce.MISSING_WORD:return r.feedback=xe.missingWordError,r.author="Missing Word Hint",r.parent_id=e.response.key,r.concept_results=[c("N5VXCdTAs91gP46gATuvPQ")],r;default:return}}function V(e){var r=B(e);return r.author="Flexible "+r.author,r}function Q(e,r){var n=function(e){return t.stringNormalize(e)};return F(e,i(r),n)}function Y(e,r){var n=function(e){return b(t.stringNormalize(e)).toLowerCase()};return F(e,i(r),n)}function F(e,r,t,o){void 0===o&&(o=!1),o||(r=n.sortBy(r,"count").reverse());var i,u=n.find(r,function(r){return i=He(t(r.text),t(e))});if(u){var a=qe(u.text,e);return Object.assign({},{response:u,errorType:i},a)}}function J(e){try{var r=(new(void 0)).lex(e);return(new(void 0)).tag(r)}catch(e){return}}function G(e){var r=J(e);if(r)return r.map(function(e){return[e[0],e[1]]})}function U(e){var r=n.map(e,function(e){return te(e).split(" ")});return n.intersection.apply(n,r)}function X(e){var r=U(e);return n.reject(r,function(e){if(G(e)[0]){var r=G(e)[0][1];return!Be[r]}return!0})}function Z(e,r){var t=X(r),o=te(e).split(" ");return n.reject(t,function(e){return n.contains(o,e)})}function $(e,r){var n=oe(r),t=te(r),o=t.indexOf(e);return n.substring(o,e.length+o)}function K(e,r,n){return n?"<p>Revise your work. Use all the words from the prompt, and make it complete by adding to it.</p>":"<p>Revise your sentence to include the word <em>"+$(e,r[0])+"</em>. You may have misspelled it.</p>"}function ee(e){return e.map(function(e){return e.text})}function re(e,r){var t=Z(e,r);return n.sortBy(t,function(e){return e.length}).reverse()}function ne(e,r,n){void 0===n&&(n=!1);var t=ee(r),o=re(e,t);if(o.length>0)return{feedback:K(o[0],t,n)}}function te(e){return void 0===e&&(e=""),e.replace(/[.,?!;]/g,"").toLowerCase()}function oe(e){return void 0===e&&(e=""),e.replace(/[.,?!;]/g,"")}function ie(e,r){return ne(e,i(r))}function ue(e,r){var n=ie(e,r);if(n){return ae(r,n.feedback)}}function ae(e,r){return{feedback:r,author:"Required Words Hint",parent_id:u(e).id,concept_results:[c("N5VXCdTAs91gP46gATuvPQ")]}}function ce(e,r){var o=i(r);if(!(o.length<2)){var u=o.map(function(e){return t.stringNormalize(e.text).split(" ").length}),a=n.min(u)-1;return e.split(" ").length<a}}function se(e,r){if(ce(e,r))return fe(r)}function fe(e){var r=i(e),o=n.sortBy(r,function(e){return t.stringNormalize(e.text).length})[0];return{feedback:xe.minLengthError,author:"Missing Details Hint",parent_id:o.key,concept_results:[c("N5VXCdTAs91gP46gATuvPQ")]}}function de(e,r){var o=i(r);if(o.length<2)return!1;var u=o.map(function(e){return t.stringNormalize(e.text).split(" ").length}),a=n.max(u)+1;return e.split(" ").length>a}function pe(e,r){if(de(e,r))return le(r)}function le(e){var r=i(e),o=n.sortBy(r,function(e){return t.stringNormalize(e.text).length}).reverse()[0];return{feedback:xe.maxLengthError,author:"Not Concise Hint",parent_id:o.key,concept_results:[c("QYHg1tpDghy5AHWpsIodAg")]}}function he(e,r){return/^[a-z]/.test(e)}function ve(e,r){if(he(e,r))return me(r)}function me(e){return{feedback:xe.caseError,author:"Capitalization Hint",parent_id:u(e).id,concept_results:[c("S76ceOpAWR-5m-k47nu6KQ")]}}function ge(e,r){var n=e[e.length-1];return!(!n||!n.match(/[a-z]/i))}function be(e,r){if(ge(e,r))return ke(r)}function ke(e){return{feedback:xe.punctuationError,author:"Punctuation End Hint",parent_id:u(e).id,concept_results:[c("JVJhNIHGZLbHF6LYw605XA")]}}function we(e,r,n,t,o){var i={text:r,question_uid:e,count:1},u={response:r,responses:n,focusPoints:t,incorrectSequences:o},a=Ne(u,ye);if(a)return Object.assign(i,a);var c=Re(u),s=Ne(c,ye);if(s)return Object.assign(i,s);var f=Ne(u,_e);return f?Object.assign(i,f):void 0}function ye(e){var r,n,t,o;return __generator(this,function(i){switch(i.label){case 0:return r=e.response,n=e.responses,t=e.focusPoints,o=e.incorrectSequences,[4,a(r,n)];case 1:return i.sent(),[4,f(r,t,n)];case 2:return i.sent(),[4,l(r,o,n)];case 3:return i.sent(),[4,m(r,n)];case 4:return i.sent(),[4,w(r,n)];case 5:return i.sent(),[4,R(r,n)];case 6:return i.sent(),[4,P(r,n)];case 7:return i.sent(),[4,q(r,n)];case 8:return i.sent(),[4,I(r,n)];case 9:return i.sent(),[4,L(r,n)];case 10:return i.sent(),[2]}})}function _e(e){var r,n,t,o;return __generator(this,function(i){switch(i.label){case 0:return r=e.response,n=e.responses,t=e.focusPoints,o=e.incorrectSequences,[4,M(r,n)];case 1:return i.sent(),[4,ue(r,n)];case 2:return i.sent(),[4,se(r,n)];case 3:return i.sent(),[4,pe(r,n)];case 4:return i.sent(),[4,ve(r,n)];case 5:return i.sent(),[4,be(r,n)];case 6:return i.sent(),[2]}})}function Ne(e,r){for(var n=r(e),t=n.next();;){if(t.value||t.done)break;t=n.next()}if(t.value)return t.value}function Re(e){var n=Object.assign({},e),t=i(e.responses).map(function(e){return e.text});return n.response=r.correctSentenceFromSamples(t,e.response,!1),console.log("Corrected: ",n.response),n}var xe={punctuationError:"There may be an error. How could you update the punctuation?",punctuationAndCaseError:"There may be an error. How could you update the punctuation and capitalization?",typingError:"Try again. There may be a spelling mistake.",caseError:"Proofread your work. There may be a capitalization error.",minLengthError:"Revise your work. Do you have all of the information from the prompt?",maxLengthError:"Revise your work. How could this sentence be shorter and more concise?",modifiedWordError:"Revise your work. You may have mixed up or misspelled a word.",additionalWordError:"Revise your work. You may have added an extra word.",missingWordError:"Revise your work. You may have left out an important word.",whitespaceError:"There may be an error. You may have forgotten a space between two words.",flexibleModifiedWordError:"Revise your work. You may have mixed up a word.",flexibleAdditionalWordError:"Revise your work. You may have added an extra word.",flexibleMissingWordError:"Revise your work. You may have left out an important word.",spacingAfterCommaError:"<p>Revise your work. Always put a space after a <em>comma</em>.</p>"},We=[" ,"," ."," ;"," !"," ?"],Oe={" ,":"comma"," .":"period"," ;":"semi-colon"," !":"exclamation mark"," ?":"question mark"},Ae=function(e){return e.replace(/\s+/g,"")},Ee={timing:"Revise your work. Which joining word helps show the timing of the events?",opposite:"Revise your work. Which joining word helps show that the two ideas are opposite?",reason:"Revise your work. Which joining word helps tell why or give a reason?",prerequisite:"Revise your work. Which joining word helps show that one of the ideas must happen for the other one to happen?",choice:"Revise your work. Which joining word is used to show a choice?",and:"Revise your work. Which joining word is used to add another idea?"},Pe={after:{feedback:Ee.timing},"as soon as":{feedback:Ee.timing},before:{feedback:Ee.timing},whenever:{feedback:Ee.timing},while:{feedback:Ee.timing},once:{feedback:Ee.timing},when:{feedback:Ee.timing},until:{feedback:Ee.timing},although:{feedback:Ee.opposite},"even though":{feedback:Ee.opposite},though:{feedback:Ee.opposite},but:{feedback:Ee.opposite},yet:{feedback:Ee.opposite},since:{feedback:Ee.reason},so:{feedback:Ee.reason},because:{feedback:Ee.reason},for:{feedback:Ee.reason},as:{feedback:Ee.reason},"as long as":{feedback:Ee.prerequisite},if:{feedback:Ee.prerequisite},unless:{feedback:Ee.prerequisite},"in order to":{feedback:Ee.prerequisite},or:{feedback:Ee.choice},nor:{feedback:Ee.choice},and:{feedback:Ee.and}},Ce={NO_ERROR:"NO_ERROR",MISSING_WORD:"MISSING_WORD",ADDITIONAL_WORD:"ADDITIONAL_WORD",INCORRECT_WORD:"INCORRECT_WORD"},He=function(e,r){var n=ze(e,r),t=De(n),o=Ie(n),i=Te(n);return t?Ce.INCORRECT_WORD:o?Ce.ADDITIONAL_WORD:i?Ce.MISSING_WORD:void 0},qe=function(e,r){var t=ze(e,r),o=n.where(t,{removed:!0})[0],i=o?o.value:void 0,u=n.where(t,{added:!0})[0];return{missingText:i,extraneousText:u?u.value:void 0}},ze=function(e,r){return o.diffWords(e,r)},De=function(e){var r=!1,n=0,t=0;return e.forEach(function(e,o,i){Se(e)&&(t+=1),r=Le(e),e.removed&&Me(e)<2&&o===i.length-1?n+=1:n+=e.removed&&Me(e)<2&&i[o+1].added?1:0}),!r&&1===n&&2===t},Ie=function(e){var r=!1,n=0,t=0;return e.forEach(function(e,o,i){Se(e)&&(t+=1),r=Le(e),e.added&&Me(e)<2&&0===o?n+=1:n+=e.added&&Me(e)<2&&!i[o-1].removed?1:0}),!r&&1===n&&1===t},Te=function(e){var r=!1,n=0,t=0;return e.forEach(function(e,o,i){Se(e)&&(t+=1),r=Le(e),e.removed&&Me(e)<2&&o===i.length-1?n+=1:n+=e.removed&&Me(e)<2&&!i[o+1].added?1:0}),!r&&1===n&&1===t},Se=function(e){return e.removed||e.added},je=function(e){return Me(e)>=2},Le=function(e){return(e.removed||e.added)&&je(e)},Me=function(e){return e.value.split(" ").filter(Boolean).length};e.Tagger=require("./POSTagger"),e.Lexer=require("./lexer");var Be={JJ:"Adjective",JJR:"Adjective",JJS:"Adjective",RB:"Adverb",RBR:"Adverb",RBS:"Adverb",WRB:"Adverb",CC:"Conjunction",NN:"Noun",NNP:"Noun",NNPS:"Noun",NNS:"Noun",CD:"Number",LS:"Number",IN:"Preposition",PP$:"Pronoun",PRP:"Pronoun",WP:"Pronoun",WP$:"Pronoun",VB:"Verb",VBD:"Verb",VBG:"Verb",VBN:"Verb",VBP:"Verb",VBZ:"Verb"};e.checkSentenceCombining=we,Object.defineProperty(e,"__esModule",{value:!0})});